#!/usr/bin/env perl
# Copyright 2019 Kevin Spencer <kevin@kevinspencer.org>
#
# Permission to use, copy, modify, distribute, and sell this software and its
# documentation for any purpose is hereby granted without fee, provided that
# the above copyright notice appear in all copies and that both that
# copyright notice and this permission notice appear in supporting
# documentation. No representations are made about the suitability of this
# software for any purpose. It is provided "as is" without express or
# implied warranty.
#
################################################################################

use Data::Dumper;
use Getopt::Long;
use Mojo::UserAgent;
use Mojo::URL;
use Try::Tiny;
use strict;
use warnings;

$Data::Dumper::Indent = 1;

our $VERSION = '0.6';

# by default we'll run in queue mode and ask the backend for the things
my $mode;
GetOptions("mode=s" => \$mode);

my $bot = Mojo::UserAgent->new();
my $url = Mojo::URL->new('http://localhost:8080');
$bot->max_redirects(3);

my $response;
try {
    $response = $bot->get($url)->result();
} catch {
    print "Eeek, something bad happened: $_";
    exit();
};

if ($response->is_success()) {
    my $result_string = $response->body();
    print $result_string, "\n";
} else {
    print "Server returned code: " . $response->code() . " with message: " . $response->message(), "\n";
}
